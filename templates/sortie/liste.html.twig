{% extends 'base.html.twig' %}

{% block title %}Liste de sortie{% endblock %}

{% block body %}
    <div class='container-fluid md-5'>
        <div class='row flex-column-reverse'>
            <div class='col-3 align-self-end'>
              <p>Date du jour : {{ "now"|date("d/m/Y") }}</p>
              <p>Participant  : {{ app.user.username }}</p>
            </div>
        </div>
    </div>
    {{ form_start(rechercheSortieForm) }}
    <div class='container-fluid mt-5 ' >
        <div class='row'>
            <div class='col-md-4 '>
                <div>
                    {{ form_row(rechercheSortieForm.campus) }}
                    {{ form_row(rechercheSortieForm.contient) }}
                </div>
                <div>
                    {{ form_row(rechercheSortieForm.apres) }}
                    {{ form_row(rechercheSortieForm.avant) }}
                </div>
            </div>
            <div class='col-md-6 m-auto row form-check-inline'>
                {{ form_row(rechercheSortieForm.organise) }}
                {{ form_row(rechercheSortieForm.inscrit) }}
                {{ form_row(rechercheSortieForm.pasInscrit) }}
                {{ form_row(rechercheSortieForm.passees) }}
            </div>
        </div>
    </div>
    <div class='container mt-5'>
        <div class='d-flex justify-content-center'>
            <button class='btn-secondary btn btn-lg'>Rechercher</button>
        </div>
    </div>
        {{ form_end(rechercheSortieForm) }}

    <div class='container mt-5'>
        <table class="table table-sm text-secondary" >
            <thead>
                <tr>
                    <th>nom de la sortie </th>
                    <th>date de la sortie </th>
                    <th>clôture</th>
                    <th>inscrit/places</th>
                    <th>etat</th>
                    <th>inscrit</th>
                    <th>organisateur</th>
                    <th>action</th>
                </tr>
            </thead>
            <tbody>
                {%  for sortie in resultat %}
                    <tr>
                        <td>{{ sortie.getNom() }}</td>
                        <td>{{ sortie.getDateHeureDebut()|date("d/m/Y H:m", "Europe/Paris" ) }}</td>
                        <td>{{ sortie.getDateLimiteInscription()|date("d/m/Y") }}</td>
                        <td>{{ sortie.getParticipation()|length }}/ {{ sortie.getNbMaxInscription() }}</td>
                        <td>{{ sortie.getEtat().getLibelle() }}</td>
                        <td>
                            {% for participant in  sortie.getParticipation()%}
                                {% if participant == app.user %}
                                    x
                                {% endif %}
                            {% endfor %}
                        </td>
                        <td><a class="text-white" href="{{ path('user_detailProfil',{'id': sortie.getOrganisateur().getId() }) }}">{{ sortie.getOrganisateur().getPseudo() }}</a></td>
                    <td>
                        {% if sortie.getOrganisateur()== app.user and  sortie.etat.libelle=="créée" %}
                                    <a  class="text-white" href="{{ path('sortie_modifier',{'id':sortie.id}) }}">modifier</a>
                                    <a class="text-white" href="{{ path('sortie_supprime',{'id':sortie.id}) }}">supprimer</a>
                        {% else %}
                            <a class="text-white" href="{{ path('sortie_detail',{'id':sortie.getId()}) }}">afficher detail</a>
                        {% endif %}
                        {% set memoire=0 %}
                        {%  for participant in sortie.getParticipation() %}
                            {% if participant == app.user %}
                                {% set memoire=1 %}
                            {% endif %}
                        {% endfor %}
                        {% if memoire==1 and sortie.etat.libelle=="ouverte" %}
                            <a class="text-white" href="{{ path('sortie_desinscription',{'id':sortie.getId()}) }}">desinscription</a>
                        {% endif %}
                        {% if memoire==0 and sortie.etat.libelle=="ouverte" %}
                            <a class="text-white" href="{{ path('sortie_inscription',{'id':sortie.getId()}) }}">inscription</a>
                        {% endif%}
                    </td>
                    </tr>
                {%  endfor %}
            </tbody>
        </table>
    </div>
*{% endblock %}
